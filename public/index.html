<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poker Grind Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Auth styles */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .auth-box {
            background: #141414;
            border-radius: 16px;
            padding: 40px;
            width: 100%;
            max-width: 420px;
            border: 1px solid #2a2a2a;
        }

        .auth-title {
            text-align: center;
            color: #10b981;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .auth-subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 25px;
            background: #1a1a1a;
            border-radius: 8px;
            padding: 4px;
        }

        .auth-tab {
            flex: 1;
            padding: 10px;
            background: transparent;
            border: none;
            color: #888;
            cursor: pointer;
            border-radius: 6px;
            font-size: 0.95em;
            transition: all 0.3s ease;
        }

        .auth-tab.active {
            background: #10b981;
            color: #0a0a0a;
            font-weight: 600;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #888;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 1em;
        }

        .form-input:focus {
            outline: none;
            border-color: #10b981;
        }

        .auth-btn {
            width: 100%;
            padding: 14px;
            background: #10b981;
            color: #0a0a0a;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .auth-btn:hover {
            background: #059669;
        }

        .auth-btn:disabled {
            background: #374151;
            cursor: not-allowed;
        }

        .auth-error {
            background: #7f1d1d;
            color: #fca5a5;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9em;
            display: none;
        }

        .auth-error.show {
            display: block;
        }

        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid #2a2a2a;
            margin-bottom: 30px;
        }

        .header-left h1 {
            color: #10b981;
            font-size: 2em;
            margin-bottom: 5px;
        }

        .date-display {
            color: #888;
            font-size: 1em;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .username {
            color: #10b981;
            font-weight: 500;
        }

        .logout-btn {
            padding: 8px 16px;
            background: #374151;
            color: #e0e0e0;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s ease;
        }

        .logout-btn:hover {
            background: #4b5563;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #1a1a1a;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 24px;
            background: #1a1a1a;
            border: none;
            color: #888;
            cursor: pointer;
            border-radius: 8px 8px 0 0;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .tab:hover {
            background: #2a2a2a;
            color: #e0e0e0;
        }

        .tab.active {
            background: #10b981;
            color: #0a0a0a;
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Cards */
        .session-card {
            background: #141414;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid #2a2a2a;
        }

        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .session-title {
            font-size: 1.3em;
            color: #10b981;
        }

        .session-time {
            font-size: 2em;
            font-weight: bold;
            color: #fff;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-start {
            background: #10b981;
            color: #0a0a0a;
        }

        .btn-start:hover {
            background: #059669;
        }

        .btn-pause {
            background: #f59e0b;
            color: #0a0a0a;
        }

        .btn-pause:hover {
            background: #d97706;
        }

        .btn-reset {
            background: #374151;
            color: #e0e0e0;
        }

        .btn-reset:hover {
            background: #4b5563;
        }

        .timer-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        /* Progress */
        .progress-section {
            margin-top: 20px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            color: #888;
        }

        .progress-bar {
            height: 8px;
            background: #2a2a2a;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #059669);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        /* Summary */
        .daily-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .summary-card {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #2a2a2a;
        }

        .summary-value {
            font-size: 2em;
            font-weight: bold;
            color: #10b981;
            margin-bottom: 5px;
        }

        .summary-label {
            color: #888;
            font-size: 0.9em;
        }

        /* Inputs */
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .input-group label {
            color: #888;
            font-size: 0.9em;
        }

        .data-input {
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 6px;
            padding: 10px 12px;
            color: #e0e0e0;
            font-size: 1em;
            font-family: inherit;
        }

        .data-input:focus {
            outline: none;
            border-color: #10b981;
        }

        select.data-input {
            cursor: pointer;
        }

        /* Checklist */
        .checklist {
            list-style: none;
        }

        .checklist li {
            padding: 12px 0;
            border-bottom: 1px solid #2a2a2a;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .checklist li:last-child {
            border-bottom: none;
        }

        .checkbox {
            width: 22px;
            height: 22px;
            accent-color: #10b981;
            cursor: pointer;
        }

        .checklist label {
            cursor: pointer;
            flex: 1;
        }

        .checklist li.completed label {
            text-decoration: line-through;
            color: #666;
        }

        /* Notes */
        .notes-area {
            width: 100%;
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 8px;
            padding: 15px;
            color: #e0e0e0;
            font-family: inherit;
            font-size: 1em;
            resize: vertical;
            min-height: 120px;
        }

        .notes-area:focus {
            outline: none;
            border-color: #10b981;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .stat-card {
            background: #141414;
            border-radius: 12px;
            padding: 25px;
            border: 1px solid #2a2a2a;
        }

        .stat-title {
            color: #888;
            margin-bottom: 15px;
            font-size: 0.95em;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #10b981;
        }

        .stat-subtitle {
            color: #666;
            margin-top: 5px;
            font-size: 0.85em;
        }

        /* Bankroll */
        .bankroll-display {
            background: linear-gradient(135deg, #0d3d2e, #1a1a1a);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            border: 2px solid #10b981;
        }

        .bankroll-label {
            display: block;
            color: #888;
            font-size: 1em;
            margin-bottom: 10px;
        }

        .bankroll-value {
            font-size: 3em;
            font-weight: bold;
            color: #10b981;
        }

        /* History */
        .history-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .history-item {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #10b981;
        }

        .history-item.negative {
            border-left-color: #ef4444;
        }

        .history-date {
            color: #888;
            font-size: 0.85em;
            margin-bottom: 8px;
        }

        .history-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
        }

        .history-stat {
            text-align: center;
        }

        .history-stat-value {
            font-weight: bold;
            color: #10b981;
        }

        .history-stat-value.negative {
            color: #ef4444;
        }

        .history-stat-label {
            font-size: 0.75em;
            color: #666;
        }

        .history-empty {
            text-align: center;
            color: #666;
            padding: 20px;
        }

        /* Player notes */
        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .filter-btn {
            padding: 6px 12px;
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 4px;
            color: #888;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.3s ease;
        }

        .filter-btn:hover {
            background: #2a2a2a;
            color: #e0e0e0;
        }

        .filter-btn.active {
            background: #10b981;
            color: #0a0a0a;
            border-color: #10b981;
        }

        .player-note-item {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #10b981;
        }

        .player-note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .player-note-name {
            font-weight: bold;
            color: #10b981;
            font-size: 1.1em;
        }

        .player-note-category {
            background: #374151;
            color: #9ca3af;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
        }

        .player-note-text {
            color: #e0e0e0;
            line-height: 1.5;
        }

        .player-note-date {
            color: #666;
            font-size: 0.8em;
            margin-top: 8px;
        }

        .delete-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            margin-left: 10px;
        }

        .delete-btn:hover {
            background: #dc2626;
        }

        .optional-badge {
            background: #374151;
            color: #9ca3af;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            margin-left: 10px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #888;
        }

        @media (max-width: 768px) {
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1;
                text-align: center;
                padding: 10px 15px;
                font-size: 0.9em;
            }

            header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- Auth Screen -->
    <div id="authScreen" class="auth-container">
        <div class="auth-box">
            <h1 class="auth-title">üé∞ Poker Grind Tracker</h1>
            <p class="auth-subtitle">Connectez-vous pour tracker vos sessions</p>
            
            <div class="auth-error" id="authError"></div>

            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('login')">Connexion</button>
                <button class="auth-tab" onclick="switchAuthTab('register')">Inscription</button>
            </div>

            <form id="loginForm" class="auth-form active" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label for="loginUsername">Nom d'utilisateur ou Email</label>
                    <input type="text" id="loginUsername" class="form-input" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Mot de passe</label>
                    <input type="password" id="loginPassword" class="form-input" required>
                </div>
                <button type="submit" class="auth-btn" id="loginBtn">Se connecter</button>
            </form>

            <form id="registerForm" class="auth-form" onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label for="regUsername">Nom d'utilisateur</label>
                    <input type="text" id="regUsername" class="form-input" required minlength="3">
                </div>
                <div class="form-group">
                    <label for="regEmail">Email</label>
                    <input type="email" id="regEmail" class="form-input" required>
                </div>
                <div class="form-group">
                    <label for="regPassword">Mot de passe (min. 6 caract√®res)</label>
                    <input type="password" id="regPassword" class="form-input" required minlength="6">
                </div>
                <button type="submit" class="auth-btn" id="registerBtn">Cr√©er un compte</button>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" style="display: none;">
        <div class="container">
            <header>
                <div class="header-left">
                    <h1>üéØ Poker Grind Tracker</h1>
                    <div class="date-display" id="currentDate"></div>
                </div>
                <div class="user-info">
                    <span class="username" id="displayUsername"></span>
                    <button class="logout-btn" onclick="handleLogout()">D√©connexion</button>
                </div>
            </header>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('routine')">Routine</button>
                <button class="tab" onclick="switchTab('offTable')">Hors Tables</button>
                <button class="tab" onclick="switchTab('bankroll')">Bankroll</button>
                <button class="tab" onclick="switchTab('stats')">Stats</button>
                <button class="tab" onclick="switchTab('playerNotes')">Notes Joueurs</button>
                <button class="tab" onclick="switchTab('notes')">Notes</button>
            </div>

            <!-- Routine Tab -->
            <div id="routine" class="tab-content active">
                <div class="session-card">
                    <div class="session-header">
                        <div class="session-title">üé∞ Sessions Spin & Go</div>
                        <div class="session-time" id="spinTimer">00:00:00</div>
                    </div>
                    <div class="progress-section">
                        <div class="progress-label">
                            <span>Progression journali√®re</span>
                            <span id="spinProgress">0h / 5h</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="spinProgressBar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="timer-controls">
                        <button class="btn btn-start" onclick="startTimer('spin')">‚ñ∂ D√©marrer</button>
                        <button class="btn btn-pause" onclick="pauseTimer('spin')">‚è∏ Pause</button>
                        <button class="btn btn-reset" onclick="resetTimer('spin')">‚Ü∫ Reset</button>
                    </div>
                </div>

                <div class="session-card">
                    <div class="session-header">
                        <div class="session-title">
                            üí∞ Cash Game
                            <span class="optional-badge">Optionnel</span>
                        </div>
                        <div class="session-time" id="cashTimer">00:00:00</div>
                    </div>
                    <div class="progress-section">
                        <div class="progress-label">
                            <span>Objectif optionnel</span>
                            <span id="cashProgress">0h / 1-2h</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="cashProgressBar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="timer-controls">
                        <button class="btn btn-start" onclick="startTimer('cash')">‚ñ∂ D√©marrer</button>
                        <button class="btn btn-pause" onclick="pauseTimer('cash')">‚è∏ Pause</button>
                        <button class="btn btn-reset" onclick="resetTimer('cash')">‚Ü∫ Reset</button>
                    </div>
                </div>

                <div class="daily-summary">
                    <div class="summary-card">
                        <div class="summary-value" id="totalToday">0h 0m</div>
                        <div class="summary-label">Temps total aujourd'hui</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-value" id="hourlyRate">0‚Ç¨</div>
                        <div class="summary-label">‚Ç¨/heure aujourd'hui</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-value" id="weekTotal">0h</div>
                        <div class="summary-label">Total cette semaine</div>
                    </div>
                </div>

                <div class="session-card">
                    <div class="session-title" style="margin-bottom: 20px;">üìä Donn√©es de session</div>
                    <div class="input-grid">
                        <div class="input-group">
                            <label for="gamesPlayed">Games jou√©s</label>
                            <input type="number" id="gamesPlayed" class="data-input" placeholder="0" onchange="updateSessionData()">
                        </div>
                        <div class="input-group">
                            <label for="handsPlayed">Mains jou√©es</label>
                            <input type="number" id="handsPlayed" class="data-input" placeholder="0" onchange="updateSessionData()">
                        </div>
                        <div class="input-group">
                            <label for="earnings">Gains/Pertes (‚Ç¨)</label>
                            <input type="number" id="earnings" class="data-input" placeholder="0" step="0.01" onchange="updateSessionData()">
                        </div>
                    </div>
                    <button class="btn btn-start" style="margin-top: 20px; width: 100%;" onclick="saveSession()">üíæ Sauvegarder la session</button>
                </div>
            </div>

            <!-- Off-Table Work Tab -->
            <div id="offTable" class="tab-content">
                <div class="session-card">
                    <div class="session-header">
                        <div class="session-title">üìö Travail Hors Tables</div>
                        <div class="session-time" id="studyTimer">00:00:00</div>
                    </div>
                    <div class="progress-section">
                        <div class="progress-label">
                            <span>Objectif journalier</span>
                            <span id="studyProgress">0h / 1h</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="studyProgressBar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="timer-controls">
                        <button class="btn btn-start" onclick="startTimer('study')">‚ñ∂ D√©marrer</button>
                        <button class="btn btn-pause" onclick="pauseTimer('study')">‚è∏ Pause</button>
                        <button class="btn btn-reset" onclick="resetTimer('study')">‚Ü∫ Reset</button>
                    </div>
                </div>

                <div class="session-card">
                    <div class="session-title" style="margin-bottom: 20px;">üìã Checklist du jour</div>
                    <ul class="checklist">
                        <li>
                            <input type="checkbox" class="checkbox" id="check1" onchange="toggleCheck(this)">
                            <label for="check1">Review des mains de la veille</label>
                        </li>
                        <li>
                            <input type="checkbox" class="checkbox" id="check2" onchange="toggleCheck(this)">
                            <label for="check2">Training GTO Wizard (Push/Fold)</label>
                        </li>
                        <li>
                            <input type="checkbox" class="checkbox" id="check3" onchange="toggleCheck(this)">
                            <label for="check3">Analyse spots sp√©cifiques</label>
                        </li>
                        <li>
                            <input type="checkbox" class="checkbox" id="check4" onchange="toggleCheck(this)">
                            <label for="check4">Update Hand2Note / Stats</label>
                        </li>
                        <li>
                            <input type="checkbox" class="checkbox" id="check5" onchange="toggleCheck(this)">
                            <label for="check5">Vid√©o/Article formation</label>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Bankroll Tab -->
            <div id="bankroll" class="tab-content">
                <div class="session-card">
                    <div class="session-title" style="margin-bottom: 20px;">üí∞ Gestion de Bankroll</div>
                    <div class="bankroll-display">
                        <span class="bankroll-label">Bankroll actuelle</span>
                        <span class="bankroll-value" id="currentBankroll">0‚Ç¨</span>
                    </div>
                    <div class="input-grid" style="margin-top: 20px;">
                        <div class="input-group">
                            <label for="bankrollInput">Modifier bankroll (‚Ç¨)</label>
                            <input type="number" id="bankrollInput" class="data-input" placeholder="5000" step="0.01">
                        </div>
                        <div class="input-group">
                            <label>&nbsp;</label>
                            <button class="btn btn-start" onclick="setBankroll()">Mettre √† jour</button>
                        </div>
                    </div>
                </div>

                <div class="session-card">
                    <div class="session-title" style="margin-bottom: 20px;">üìà Statistiques Bankroll</div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-title">‚Ç¨/heure (global)</div>
                            <div class="stat-value" id="globalHourlyRate">0‚Ç¨</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-title">Gains cette semaine</div>
                            <div class="stat-value" id="weekEarnings">0‚Ç¨</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-title">Gains ce mois</div>
                            <div class="stat-value" id="monthEarnings">0‚Ç¨</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-title">ROI estim√©</div>
                            <div class="stat-value" id="roiEstimate">0%</div>
                        </div>
                    </div>
                </div>

                <div class="session-card">
                    <div class="session-title" style="margin-bottom: 20px;">üìú Historique des sessions</div>
                    <div class="history-list" id="sessionHistory">
                        <div class="loading">Chargement...</div>
                    </div>
                </div>
            </div>

            <!-- Stats Tab -->
            <div id="stats" class="tab-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-title">Heures cette semaine</div>
                        <div class="stat-value" id="weekHours">0h</div>
                        <div class="stat-subtitle">sur 35h objectif</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">Games cette semaine</div>
                        <div class="stat-value" id="weekGames">0</div>
                        <div class="stat-subtitle">total enregistr√©</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">Mains cette semaine</div>
                        <div class="stat-value" id="weekHands">0</div>
                        <div class="stat-subtitle">total enregistr√©</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">Sessions cette semaine</div>
                        <div class="stat-value" id="daysCompleted">0</div>
                        <div class="stat-subtitle">sessions enregistr√©es</div>
                    </div>
                </div>
            </div>

            <!-- Player Notes Tab -->
            <div id="playerNotes" class="tab-content">
                <div class="session-card">
                    <div class="session-title" style="margin-bottom: 20px;">‚ûï Ajouter une note joueur</div>
                    <div class="input-grid">
                        <div class="input-group">
                            <label for="playerName">Nom du joueur</label>
                            <input type="text" id="playerName" class="data-input" placeholder="Pseudo">
                        </div>
                        <div class="input-group">
                            <label for="noteCategory">Cat√©gorie</label>
                            <select id="noteCategory" class="data-input">
                                <option value="HU">HU (Heads Up)</option>
                                <option value="BvB">BvB (Blind vs Blind)</option>
                                <option value="BBvsBU">BB vs BU</option>
                                <option value="BBvsSB">BB vs SB</option>
                                <option value="BUvsBB">BU vs BB</option>
                                <option value="SBvsBB">SB vs BB</option>
                                <option value="3way">3-Way</option>
                                <option value="general">G√©n√©ral</option>
                            </select>
                        </div>
                    </div>
                    <div class="input-group" style="margin-top: 15px;">
                        <label for="playerNoteText">Note</label>
                        <textarea id="playerNoteText" class="notes-area" style="min-height: 80px;" placeholder="Ex: Limp/fold trop souvent en SB, over-fold vs 3bet..."></textarea>
                    </div>
                    <button class="btn btn-start" style="margin-top: 15px;" onclick="addPlayerNote()">Ajouter la note</button>
                </div>

                <div class="session-card">
                    <div class="session-title" style="margin-bottom: 20px;">üîç Rechercher un joueur</div>
                    <div class="input-group">
                        <input type="text" id="searchPlayer" class="data-input" placeholder="Rechercher par nom..." oninput="searchPlayerNotes()">
                    </div>
                    <div class="filter-buttons" style="margin-top: 10px;">
                        <button class="filter-btn active" onclick="filterNotes('all', this)">Tous</button>
                        <button class="filter-btn" onclick="filterNotes('HU', this)">HU</button>
                        <button class="filter-btn" onclick="filterNotes('BvB', this)">BvB</button>
                        <button class="filter-btn" onclick="filterNotes('BBvsBU', this)">BB vs BU</button>
                        <button class="filter-btn" onclick="filterNotes('BBvsSB', this)">BB vs SB</button>
                        <button class="filter-btn" onclick="filterNotes('3way', this)">3-Way</button>
                        <button class="filter-btn" onclick="filterNotes('general', this)">G√©n√©ral</button>
                    </div>
                </div>

                <div class="session-card">
                    <div class="session-title" style="margin-bottom: 20px;">üìö Notes enregistr√©es</div>
                    <div class="player-notes-list" id="playerNotesList">
                        <div class="loading">Chargement...</div>
                    </div>
                </div>
            </div>

            <!-- Session Notes Tab -->
            <div id="notes" class="tab-content">
                <div class="session-card">
                    <div class="session-title" style="margin-bottom: 20px;">üìù Notes de session</div>
                    <textarea class="notes-area" id="sessionNotes" placeholder="Notes sur ta session du jour...
- Leaks identifi√©s
- Spots difficiles
- Ajustements √† faire
- Mental game
- Objectifs pour demain" onchange="saveSettings()"></textarea>
                </div>

                <div class="session-card">
                    <div class="session-title" style="margin-bottom: 20px;">üéØ Objectifs de la semaine</div>
                    <textarea class="notes-area" id="weeklyGoals" placeholder="Tes objectifs hebdomadaires...
- Technique : 
- Volume : 
- Bankroll : 
- Mental : " onchange="saveSettings()"></textarea>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State
        let currentUser = null;
        let allSessions = [];
        let allPlayerNotes = [];
        let currentFilter = 'all';

        const timers = {
            spin: { seconds: 0, interval: null, running: false },
            cash: { seconds: 0, interval: null, running: false },
            study: { seconds: 0, interval: null, running: false }
        };

        // Auth functions
        function switchAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            if (tab === 'login') {
                document.querySelector('.auth-tab:first-child').classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                document.querySelector('.auth-tab:last-child').classList.add('active');
                document.getElementById('registerForm').classList.add('active');
            }
            hideAuthError();
        }

        function showAuthError(message) {
            const errorEl = document.getElementById('authError');
            errorEl.textContent = message;
            errorEl.classList.add('show');
        }

        function hideAuthError() {
            document.getElementById('authError').classList.remove('show');
        }

        async function handleLogin(e) {
            e.preventDefault();
            const btn = document.getElementById('loginBtn');
            btn.disabled = true;
            btn.textContent = 'Connexion...';
            hideAuthError();

            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const res = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const data = await res.json();
                if (data.success) {
                    currentUser = data.user;
                    showMainApp();
                } else {
                    showAuthError(data.error);
                }
            } catch (err) {
                showAuthError('Erreur de connexion au serveur');
            }

            btn.disabled = false;
            btn.textContent = 'Se connecter';
        }

        async function handleRegister(e) {
            e.preventDefault();
            const btn = document.getElementById('registerBtn');
            btn.disabled = true;
            btn.textContent = 'Cr√©ation...';
            hideAuthError();

            const username = document.getElementById('regUsername').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;

            try {
                const res = await fetch('/api/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, email, password })
                });

                const data = await res.json();
                if (data.success) {
                    currentUser = data.user;
                    showMainApp();
                } else {
                    showAuthError(data.error);
                }
            } catch (err) {
                showAuthError('Erreur de connexion au serveur');
            }

            btn.disabled = false;
            btn.textContent = 'Cr√©er un compte';
        }

        async function handleLogout() {
            await fetch('/api/logout', { method: 'POST' });
            currentUser = null;
            document.getElementById('authScreen').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
        }

        async function checkAuth() {
            try {
                const res = await fetch('/api/me');
                if (res.ok) {
                    const data = await res.json();
                    currentUser = data.user;
                    showMainApp();
                }
            } catch (err) {
                // Not logged in
            }
        }

        function showMainApp() {
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('displayUsername').textContent = currentUser.username;
            setCurrentDate();
            loadAllData();
        }

        // Data loading
        async function loadAllData() {
            await Promise.all([
                loadSessions(),
                loadBankroll(),
                loadPlayerNotes(),
                loadSettings(),
                loadStats()
            ]);
        }

        async function loadSessions() {
            const res = await fetch('/api/sessions');
            const data = await res.json();
            allSessions = data.sessions;
            renderSessionHistory();
        }

        async function loadBankroll() {
            const res = await fetch('/api/bankroll');
            const data = await res.json();
            document.getElementById('currentBankroll').textContent = data.amount.toFixed(2) + '‚Ç¨';
        }

        async function loadPlayerNotes() {
            const res = await fetch('/api/player-notes');
            const data = await res.json();
            allPlayerNotes = data.notes;
            renderPlayerNotes();
        }

        async function loadSettings() {
            const res = await fetch('/api/settings');
            const data = await res.json();
            if (data.settings) {
                document.getElementById('sessionNotes').value = data.settings.session_notes || '';
                document.getElementById('weeklyGoals').value = data.settings.weekly_goals || '';
            }
        }

        async function loadStats() {
            const res = await fetch('/api/stats');
            const data = await res.json();

            document.getElementById('weekHours').textContent = data.weekHours.toFixed(1) + 'h';
            document.getElementById('weekGames').textContent = data.weekGames;
            document.getElementById('weekHands').textContent = data.weekHands;
            document.getElementById('daysCompleted').textContent = data.daysThisWeek;
            document.getElementById('weekTotal').textContent = data.weekHours.toFixed(1) + 'h';

            document.getElementById('globalHourlyRate').textContent = data.globalHourlyRate.toFixed(2) + '‚Ç¨';
            document.getElementById('weekEarnings').textContent = 
                (data.weekEarnings >= 0 ? '+' : '') + data.weekEarnings.toFixed(2) + '‚Ç¨';
            document.getElementById('monthEarnings').textContent = 
                (data.monthEarnings >= 0 ? '+' : '') + data.monthEarnings.toFixed(2) + '‚Ç¨';
            document.getElementById('roiEstimate').textContent = data.weekROI.toFixed(1) + '%';
        }

        // Timer functions
        function formatTime(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 60;
            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        function updateDisplay(type) {
            const timer = timers[type];
            document.getElementById(`${type}Timer`).textContent = formatTime(timer.seconds);
            
            const hours = timer.seconds / 3600;
            let targetHours, progressId, barId, progressText;
            
            if (type === 'spin') {
                targetHours = 5;
                progressId = 'spinProgress';
                barId = 'spinProgressBar';
                progressText = `${hours.toFixed(1)}h / 5h`;
            } else if (type === 'cash') {
                targetHours = 1.5;
                progressId = 'cashProgress';
                barId = 'cashProgressBar';
                progressText = `${hours.toFixed(1)}h / 1-2h`;
            } else {
                targetHours = 1;
                progressId = 'studyProgress';
                barId = 'studyProgressBar';
                progressText = `${hours.toFixed(1)}h / 1h`;
            }
            
            const percentage = Math.min((hours / targetHours) * 100, 100);
            document.getElementById(progressId).textContent = progressText;
            document.getElementById(barId).style.width = `${percentage}%`;
            
            updateSummary();
        }

        function updateSummary() {
            const totalSeconds = timers.spin.seconds + timers.cash.seconds;
            const totalHours = totalSeconds / 3600;
            const totalMinutes = Math.floor((totalSeconds % 3600) / 60);
            
            document.getElementById('totalToday').textContent = 
                `${Math.floor(totalHours)}h ${totalMinutes}m`;

            updateSessionData();
        }

        function startTimer(type) {
            if (!timers[type].running) {
                timers[type].running = true;
                timers[type].interval = setInterval(() => {
                    timers[type].seconds++;
                    updateDisplay(type);
                }, 1000);
            }
        }

        function pauseTimer(type) {
            timers[type].running = false;
            clearInterval(timers[type].interval);
        }

        function resetTimer(type) {
            pauseTimer(type);
            timers[type].seconds = 0;
            updateDisplay(type);
        }

        // Session functions
        function updateSessionData() {
            const earnings = parseFloat(document.getElementById('earnings').value) || 0;
            const totalSeconds = timers.spin.seconds + timers.cash.seconds;
            const totalHours = totalSeconds / 3600;

            if (totalHours > 0) {
                const hourlyRate = earnings / totalHours;
                document.getElementById('hourlyRate').textContent = hourlyRate.toFixed(2) + '‚Ç¨';
            } else {
                document.getElementById('hourlyRate').textContent = '0‚Ç¨';
            }
        }

        async function saveSession() {
            const games = parseInt(document.getElementById('gamesPlayed').value) || 0;
            const hands = parseInt(document.getElementById('handsPlayed').value) || 0;
            const earnings = parseFloat(document.getElementById('earnings').value) || 0;
            const playTime = timers.spin.seconds + timers.cash.seconds;
            const studyTime = timers.study.seconds;

            if (playTime === 0 && games === 0) {
                alert('Aucune donn√©e √† sauvegarder');
                return;
            }

            try {
                const res = await fetch('/api/sessions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        date: new Date().toISOString(),
                        playTime,
                        studyTime,
                        games,
                        hands,
                        earnings
                    })
                });

                if (res.ok) {
                    alert('Session sauvegard√©e !');
                    // Reset inputs
                    document.getElementById('gamesPlayed').value = '';
                    document.getElementById('handsPlayed').value = '';
                    document.getElementById('earnings').value = '';
                    resetTimer('spin');
                    resetTimer('cash');
                    resetTimer('study');
                    
                    // Reload data
                    await loadAllData();
                }
            } catch (err) {
                alert('Erreur lors de la sauvegarde');
            }
        }

        function renderSessionHistory() {
            const container = document.getElementById('sessionHistory');
            
            if (allSessions.length === 0) {
                container.innerHTML = '<div class="history-empty">Aucune session enregistr√©e</div>';
                return;
            }

            container.innerHTML = allSessions.slice(0, 15).map(session => {
                const date = new Date(session.date);
                const dateStr = date.toLocaleDateString('fr-FR', { 
                    weekday: 'short', 
                    day: 'numeric', 
                    month: 'short' 
                });
                const hours = (session.play_time / 3600).toFixed(1);
                const isNegative = session.earnings < 0;

                return `
                    <div class="history-item ${isNegative ? 'negative' : ''}">
                        <div class="history-date">${dateStr}</div>
                        <div class="history-stats">
                            <div class="history-stat">
                                <div class="history-stat-value">${hours}h</div>
                                <div class="history-stat-label">Temps</div>
                            </div>
                            <div class="history-stat">
                                <div class="history-stat-value">${session.games}</div>
                                <div class="history-stat-label">Games</div>
                            </div>
                            <div class="history-stat">
                                <div class="history-stat-value">${session.hands}</div>
                                <div class="history-stat-label">Mains</div>
                            </div>
                            <div class="history-stat">
                                <div class="history-stat-value ${isNegative ? 'negative' : ''}">${session.earnings >= 0 ? '+' : ''}${session.earnings.toFixed(2)}‚Ç¨</div>
                                <div class="history-stat-label">Gains</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Bankroll functions
        async function setBankroll() {
            const value = document.getElementById('bankrollInput').value;
            if (!value) return;

            try {
                await fetch('/api/bankroll', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ amount: parseFloat(value) })
                });

                document.getElementById('currentBankroll').textContent = parseFloat(value).toFixed(2) + '‚Ç¨';
                document.getElementById('bankrollInput').value = '';
            } catch (err) {
                alert('Erreur lors de la mise √† jour');
            }
        }

        // Player notes functions
        async function addPlayerNote() {
            const name = document.getElementById('playerName').value.trim();
            const category = document.getElementById('noteCategory').value;
            const text = document.getElementById('playerNoteText').value.trim();

            if (!name || !text) {
                alert('Veuillez remplir le nom et la note');
                return;
            }

            try {
                const res = await fetch('/api/player-notes', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        playerName: name,
                        category,
                        noteText: text
                    })
                });

                if (res.ok) {
                    const data = await res.json();
                    allPlayerNotes.unshift(data.note);
                    renderPlayerNotes();

                    document.getElementById('playerName').value = '';
                    document.getElementById('playerNoteText').value = '';
                }
            } catch (err) {
                alert('Erreur lors de l\'ajout');
            }
        }

        function renderPlayerNotes() {
            const container = document.getElementById('playerNotesList');
            const search = document.getElementById('searchPlayer').value.toLowerCase();
            
            let filtered = allPlayerNotes;
            if (currentFilter !== 'all') {
                filtered = filtered.filter(n => n.category === currentFilter);
            }
            if (search) {
                filtered = filtered.filter(n => n.player_name.toLowerCase().includes(search));
            }

            if (filtered.length === 0) {
                container.innerHTML = '<div class="history-empty">Aucune note trouv√©e</div>';
                return;
            }

            container.innerHTML = filtered.map(note => {
                const date = new Date(note.created_at).toLocaleDateString('fr-FR', {
                    day: 'numeric',
                    month: 'short',
                    year: 'numeric'
                });

                return `
                    <div class="player-note-item">
                        <div class="player-note-header">
                            <span class="player-note-name">${note.player_name}</span>
                            <div>
                                <span class="player-note-category">${note.category}</span>
                                <button class="delete-btn" onclick="deletePlayerNote(${note.id})">‚úï</button>
                            </div>
                        </div>
                        <div class="player-note-text">${note.note_text}</div>
                        <div class="player-note-date">${date}</div>
                    </div>
                `;
            }).join('');
        }

        function filterNotes(category, btn) {
            currentFilter = category;
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderPlayerNotes();
        }

        function searchPlayerNotes() {
            renderPlayerNotes();
        }

        async function deletePlayerNote(id) {
            if (!confirm('Supprimer cette note ?')) return;

            try {
                await fetch(`/api/player-notes/${id}`, { method: 'DELETE' });
                allPlayerNotes = allPlayerNotes.filter(n => n.id !== id);
                renderPlayerNotes();
            } catch (err) {
                alert('Erreur lors de la suppression');
            }
        }

        // Settings
        async function saveSettings() {
            const weeklyGoals = document.getElementById('weeklyGoals').value;
            const sessionNotes = document.getElementById('sessionNotes').value;

            await fetch('/api/settings', {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ weeklyGoals, sessionNotes })
            });
        }

        // UI functions
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function toggleCheck(checkbox) {
            const li = checkbox.parentElement;
            if (checkbox.checked) {
                li.classList.add('completed');
            } else {
                li.classList.remove('completed');
            }
        }

        function setCurrentDate() {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const date = new Date().toLocaleDateString('fr-FR', options);
            document.getElementById('currentDate').textContent = date.charAt(0).toUpperCase() + date.slice(1);
        }

        // Initialize
        checkAuth();
    </script>
</body>
</html>
